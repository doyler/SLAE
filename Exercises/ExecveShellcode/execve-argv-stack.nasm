; Filename: execve-argv-stack.nasm
; Author: Ray Doyle
; Website: https://www.doyler.net
;
; Purpose: Execute `/bin/ls -a` via the stack

global _start

section .text
_start:
    xor eax, eax
    push eax

    ; PUSH /bin//ls onto the stack
    push 0x736c2f2f
    push 0x6e69622f

    ; Load the "/bin//ls" null-terminated string into EBX
    mov ebx, esp

    ; Load 0x00000000 into EDX (envp for sys_execve)
    push eax
    mov edx, esp

    push eax
    
    ; PUSH -a onto the stack and load into ESI for later
    push 0x612d
    mov esi, esp

    ; Push the argument struct onto the stack in the proper order, and load into ECX
    push eax
    push esi
    push ebx
    mov ecx, esp

    ; Execute sys_execve
    mov al,11
    int 0x80